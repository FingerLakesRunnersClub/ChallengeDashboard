@using System.Text.Json
@using FLRC.ChallengeDashboard
@model ResultsViewModel<ushort>

@await Html.PartialAsync("CourseInfo", Model.Course)
@await Html.PartialAsync("ResultFilter")

<h5>
    Total runs: @Model.RankedResults.Sum(r => r.Value)
    (@(Model.RankedResults.Sum(r => r.Value) * Model.Course.Meters / Course.MetersPerMile) miles)
</h5>

<h6>Average runs per athlete: @Model.Course.AverageThreshold(Model.Category)</h6>

<script>
    const fields = [
        { name: 'Rank', center: true, value: r => r.Rank.Value },
        { name: 'Name', center: false, value: r => r.Athlete.Name, link: r => `/Athlete/Index/${r.Athlete.ID}` },
        { name: 'Age', center: true, value: r => r.Athlete.Age },
        { name: 'Team', center: true, value: r => r.Athlete.Team.Display, sort: r => r.Athlete.Team.Value },
        { name: '# of Runs', center: true, value: r => r.Count }
    ];

    results = @Html.Raw(JsonSerializer.Serialize(Model.RankedResults));
</script>

@await Html.PartialAsync("Results")