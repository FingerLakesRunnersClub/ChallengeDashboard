@using ChallengeDashboard
@model IEnumerable<Course>

@foreach (var course in Model)
{
    var top3f = course.Results.Where(r => r.Athlete.Category == "F").OrderBy(r => r.Duration).Take(3);

    <h4>@course.Name</h4>

    <a href="/Home/Course/@course.ID">View All</a>

    <div class="row">
        @foreach (var category in Enum.GetNames(typeof(Categories)))
        {
            var top3 = course.Results
                .Where(r => r.Athlete.Category[0] == Convert.ToChar(Enum.Parse(typeof(Categories), category)))
                .OrderBy(r => r.Duration)
                .Take(3).ToArray();

            if (top3.Length > 0)
            {
                <div class="col-sm-6 col-md-5 col-lg-3">
                    <table class="table table-bordered table-striped table-sm">
                        <thead>
                        <tr>
                            <th colspan="3" class="text-center">Fastest 3 @category</th>
                        </tr>
                        </thead>
                        <tbody>
                        @for (var place = 1; place <= top3.Length; place++)
                        {
                            var result = top3[place - 1];
                            var hours = result.Duration.Hours > 0 ? @"h\:" : "";
                            <tr>
                                <td class="text-center">@place</td>
                                <td>@result.Athlete.Name</td>
                                <td class="text-right">@result.Duration.ToString($@"{hours}mm\:ss\.f")</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
        }
    </div>
}